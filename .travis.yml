language: cpp
script: make unit
dist: trusty

env:
  global:
    - CIBW_BUILD='cp37-*'
    - CIBW_TEST_REQUIRES='pytest'
    - CIBW_TEST_COMMAND='python -m pytest'
    - CIBW_BEFORE_BUILD='pip install "numpy>=1.16" && pip install "pandas>=0.24" && pip install "pytest>=4.3"'
    - CIBW_TEST_REQUIRES='pytest'
    - CIBW_TEST_COMMAND='python3 -m pytest tests'
    - TWINE_USERNAME=hfmuehleisen
    - secure: ""

matrix:
  include:

    - os: linux
      name: Python Package

      dist: xenial
      language: python
      python: 3.7

      before_script:
        - cd tools/pythonpkg

      script:
        - pip install cibuildwheel==0.10.1
        - cibuildwheel --output-dir wheelhouse
        - |
          if [[ $TRAVIS_TAG ]]; then
            pip install twine
            python -m twine upload --skip-existing wheelhouse/*.whl
          fi

before_install:
  - eval "${MATRIX_EVAL}"
